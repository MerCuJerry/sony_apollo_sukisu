From b13f64402642e3cc50281946add4d90fcbf319b6 Mon Sep 17 00:00:00 2001
From: MerCuJerry <mercujerry@gmail.com>
Date: Fri, 5 Sep 2025 20:15:29 +0800
Subject: [PATCH] fix: fix build error while using clang

---
 arch/arm64/Makefile                                    | 6 +-----
 drivers/staging/qca-wifi-host-cmn/hif/src/ce/ce_main.c | 2 +-
 drivers/staging/qca-wifi-host-cmn/qdf/inc/qdf_status.h | 1 +
 drivers/staging/qcacld-3.0/core/dp/htt/htt_h2t.c       | 4 ++--
 4 files changed, 5 insertions(+), 8 deletions(-)

diff --git a/arch/arm64/Makefile b/arch/arm64/Makefile
index 715422cdc..3fc5b31c0 100644
--- a/arch/arm64/Makefile
+++ b/arch/arm64/Makefile
@@ -66,11 +66,7 @@ ifeq ($(CONFIG_COMPAT_VDSO), y)
     $(error CROSS_COMPILE_ARM32 not defined or empty, the compat vDSO will not be built)
   else ifeq ($(cc-name),clang)
     export CLANG_TRIPLE_ARM32 ?= $(CROSS_COMPILE_ARM32)
-    export CLANG_TARGET_ARM32 := --target=arm-linux-gnueabi
-    export GCC_TOOLCHAIN32_DIR := $(dir $(shell which $(CROSS_COMPILE_ARM32)ld))
-    export GCC_TOOLCHAIN32 := $(realpath $(GCC_TOOLCHAIN32_DIR)/..)
-    export CLANG_PREFIX32 := --prefix=$(GCC_TOOLCHAIN32_DIR)
-    export CLANG_GCC32_TC := --gcc-toolchain=$(GCC_TOOLCHAIN32)
+    export CLANG_TARGET_ARM32 := --target=$(notdir $(CLANG_TRIPLE_ARM32:%-=%))
     export CONFIG_VDSO32 := y
     vdso32 := -DCONFIG_VDSO32=1
   else ifeq ($(shell which $(CROSS_COMPILE_ARM32)$(cc-name) 2> /dev/null),)
diff --git a/drivers/staging/qca-wifi-host-cmn/hif/src/ce/ce_main.c b/drivers/staging/qca-wifi-host-cmn/hif/src/ce/ce_main.c
index 2f7bdecf9..0dd7b0c51 100644
--- a/drivers/staging/qca-wifi-host-cmn/hif/src/ce/ce_main.c
+++ b/drivers/staging/qca-wifi-host-cmn/hif/src/ce/ce_main.c
@@ -1750,7 +1750,7 @@ hif_send_head(struct hif_opaque_softc *hif_ctx,
 
 	if (qdf_unlikely(ce_hdl == NULL)) {
 		HIF_ERROR("%s: error CE handle is null", __func__);
-		return A_ERROR;
+		return QDF_STATUS_ERROR;
 	}
 
 	QDF_NBUF_UPDATE_TX_PKT_COUNT(nbuf, QDF_NBUF_TX_PKT_HIF);
diff --git a/drivers/staging/qca-wifi-host-cmn/qdf/inc/qdf_status.h b/drivers/staging/qca-wifi-host-cmn/qdf/inc/qdf_status.h
index 00fe80602..3b37ad2af 100644
--- a/drivers/staging/qca-wifi-host-cmn/qdf/inc/qdf_status.h
+++ b/drivers/staging/qca-wifi-host-cmn/qdf/inc/qdf_status.h
@@ -81,6 +81,7 @@
  * @QDF_STATUS_MAX: not a realy value just a place holder for max
  */
 typedef enum {
+	QDF_STATUS_ERROR = -1,
 	QDF_STATUS_SUCCESS,
 	QDF_STATUS_E_RESOURCES,
 	QDF_STATUS_E_NOMEM,
diff --git a/drivers/staging/qcacld-3.0/core/dp/htt/htt_h2t.c b/drivers/staging/qcacld-3.0/core/dp/htt/htt_h2t.c
index b2ca24249..04fe0ad00 100644
--- a/drivers/staging/qcacld-3.0/core/dp/htt/htt_h2t.c
+++ b/drivers/staging/qcacld-3.0/core/dp/htt/htt_h2t.c
@@ -616,7 +616,7 @@ htt_h2t_rx_ring_cfg_msg_hl(struct htt_pdev_t *pdev)
 
 	pkt = htt_htc_pkt_alloc(pdev);
 	if (!pkt)
-		return A_ERROR; /* failure */
+		return QDF_STATUS_ERROR; /* failure */
 
 	/*
 	 * show that this is not a tx frame download
@@ -632,7 +632,7 @@ htt_h2t_rx_ring_cfg_msg_hl(struct htt_pdev_t *pdev)
 		HTC_HEADER_LEN + HTC_HDR_ALIGNMENT_PADDING, 4, true);
 	if (!msg) {
 		htt_htc_pkt_free(pdev, pkt);
-		return A_ERROR; /* failure */
+		return QDF_STATUS_ERROR; /* failure */
 	}
 	/*
 	 * Set the length of the message.
-- 
2.51.0

